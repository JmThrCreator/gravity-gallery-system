{% extends "base.html" %}

{% block script %}
    <script rel="javascript" type="text/javascript" src="static/js/index.js"></script>
    <script>
        let suggestions = {{ usernames|tojson }};

        // Get elements
        const searchWrapper = document.querySelector(".search-input");
        const inputBox = searchWrapper.querySelector("input");
        const suggestionBox = searchWrapper.querySelector(".autocom-box");

        // Key
        inputBox.onkeyup = (e)=>{
            let searchData  = e.target.value;
            let itemArray = [];

            if (searchData) {
                itemArray = suggestions.filter((data)=>{
                    // filter the data
                    return data.toLocaleLowerCase().startsWith(searchData.toLocaleLowerCase());
                });
                // only first 5 items
                itemArray = itemArray.slice(0,5);
                itemArray = itemArray.map((data)=>{
                    return data = "<li>" + data + "</li>";
                });
                if (itemArray.length > 0){
                    searchWrapper.classList.add("active");
                }
                else{
                    searchWrapper.classList.remove("active");
                }
                
            }
            else {
                searchWrapper.classList.remove("active");
            }
            showSuggestions(itemArray);
        }

        function showSuggestions(list){
            let listData;
            if (!list.length){
                itemArray = inputBox.value;
                listData = list.join("");
                suggestionBox.innerHTML = listData;
            }
            else{
                listData = list.join("");
                suggestionBox.innerHTML = listData;
            }
            suggestionBox.innerHTML = listData;
        }
    </script>

{% endblock %}

{% block head %}
    <link rel="stylesheet" type="text/css" href="static/css/index.css">
{% endblock %}

{% block style %}
<style>
    body{
        font-family: 'Roboto', sans-serif;
        color: white;
    }
    .header{
        display:flex;
        justify-content: center;
        align-items: center;
        margin-top:40px;
    }
    .header button {
        position:absolute;
        background-color: transparent;
        border: none;

        color: white;
        font-family: 'Roboto', sans-serif;
        font-size:15px;
    }
    #signup_button{
        right:30px;
        border: white solid 2px;
        border-radius: 10px;
        height:45px;
        line-height: 0px;
        width:100px;
    }
    #login_button{
        right:160px;
    }
    #logout{
        right:100px;

        border: white solid 2px;
        border-radius: 10px;
        height:45px;
        line-height: 0px;
        width:100px;
    }
    .header button:hover{
        cursor: pointer;
        filter: brightness(0.7);
    }
    #profile {
        color: white;
        position: absolute;
        right:30px;
        font-size:45px;
    }
    #profile:hover{
        cursor: pointer;
        filter: brightness(0.7);
    }




    .search-input.active .autocom-box{
        padding:10px;
        opacity:1;
        pointer-events: auto;
    }
    .search-input.active .autocom-box li{
        display: block;
    }
    .wrapper .search-input.active{
        border-radius: 10px;
    }

    .wrapper {
        color:black;
        margin: 150px auto;
        width: 400px;
    }   
    .wrapper .search-input{
        background: white;
        border-radius: 20px;
        box-shadow: 0px 0px 10px rgba(0,0,0,0.3);
    }
    .search-input input{
        height:45px;
        width:350px;
        outline:none;
        border:none;
        border-radius:20px;
        padding: 0 15px 0 20px;
        font-size:16px;
    }
    .wrapper .icon{
        position: absolute;
        height:45px;
        width:45px;
        line-height: 42px;
        top:0;
        right:0;
        text-align:center;
        font-size:20px;
        color: rgb(44, 45, 51);
    }
    .search-input .autocom-box{
        max-height: 280px;
        overflow-y: auto;

        opacity:0;
        pointer-events: none;
    }
    .autocom-box li{
        list-style: none;
        padding: 10px 10px 0px 10px;
        border-radius: 10px;
        height:30px;
        cursor: pointer;


        display:none;
    }
    .autocom-box li:hover{
        background: rgb(236, 236, 236);
    }


</style>
{% endblock %}

{% block content %}
    <form action="{{ url_for('main.index') }}" method="post">
        <div class="header">
            <h1 style="position:absolute; left:30px">Gravity Gallery</h1>
            {% if authenticated == False %}
                <button id="login_button" type="submit" name="login"><h2>Log In</h2></button>
                <button id="signup_button" type="submit" name="signup"><h2>Sign Up</h2></button>
            {% else %}
                <button id="logout" type="submit" name="logout"><h2>Log Out</h2></button>
                <a id="profile" href="{{ url_for('main.profile') }}"><i class="bi bi-card-image"></i></a>
            {% endif %}
        </div>
        <div class="wrapper">
            <div class="search-input">
                <input type="text" id="search-input" name="search" placeholder="Search" autocomplete="off">
                <div class="autocom-box">
                </div>
                <div class="icon"><i class="fa fa-search"></i></div>
            </div>
        </div>
{% endblock %}

